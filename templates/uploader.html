<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Scan Automatique</title>
    </head>
<body>
    <script>
        // ... (your existing Javascript code before the 'finally' block) ...
                } catch (e) {
                    statusDiv.textContent = `❌ ${e.message}`;
                    statusDiv.style.color = 'var(--danger-color)';
                } finally {
                    setTimeout(() => { 
                        isProcessing = false; 
                        detectionStartTime = null;
                        statusDiv.style.color = 'white';
                    }, 1000); // MODIFIED: Reduced delay from 2000ms to 1000ms
                }
            }, 'image/jpeg', 0.8); // MODIFIED: Reduced quality from 0.9 to 0.8 for faster uploads
        }

        // Notifier le serveur quand l'utilisateur quitte la page
        window.addEventListener('beforeunload', () => {
            if (sessionId) {
                // Use sendBeacon for reliable background sending
                const data = new FormData();
                navigator.sendBeacon(`${apiBaseUrl}/api/finish-session/${sessionId}`, data);
            }
        });
    </script>
</body>
</html>
